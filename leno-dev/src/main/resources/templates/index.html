<!DOCTYPE HTML>
<!-- thymeleaf模板必须引入 -->
<!DOCTYPE HTML>

<!-- thymeleaf模板必须引入 -->
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>极简开发</title>
    <link rel="icon" href="logo.ico" type="images/x-ico"/>
    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" rel="stylesheet">
    <link th:src="@{/libs/css/bootstrap.alert.css}" rel="stylesheet">


    <style>
        table td {
            table-layout: fixed;
            /*max-width: 30px;*/
            overflow: hidden;
            /*text-overflow: ellipsis;*/
            white-space: nowrap;
        }

        table td:hover {
            overflow: auto;
            /*white-space:  pre-wrap;*/
        }

        /*防止图片被选中*/
        .nao {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
    </style>
</head>
<body>
<!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
<script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
<script th:src="@{libs/js/jquery.js}"></script>
<!--<script th:src="@{libs/js/bootstrap.min.js}"></script>-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
<script th:src="@{libs/js/bootstrap.alert.js}"></script>


<div class="container">
    <div class="row clearfix">
        <!--导航栏信息-->
        <div class="col-md-12 column">
            <nav class="navbar navbar-default" role="navigation">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse"
                            data-target="#bs-example-navbar-collapse-1"><span
                            class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span
                            class="icon-bar"></span><span class="icon-bar"></span></button>
                    <a style="color: #f3a1a3" class="navbar-brand" href="#">Leno</a>
                </div>

                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <!--                        class="active"-->
                        <li class="active">
                            <a role="button"
                               class="btn" style="color:#f3a1a3" href="#">开发</a>
                        </li>
                        <li>
                            <a style="color:#f3a1a3" id="modal-85792" href="#modal-container-85792" role="button"
                               class="btn"
                               data-toggle="modal">音乐</a>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">探索中<strong
                                    class="caret"></strong></a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="#">Action</a>
                                </li>
                                <li>
                                    <a href="#">Another action</a>
                                </li>
                                <li>
                                    <a href="#">Something else here</a>
                                </li>
                                <li class="divider">
                                </li>
                                <li>
                                    <a href="#">Separated link</a>
                                </li>
                                <li class="divider">
                                </li>
                                <li>
                                    <a href="#">One more separated link</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                    <form class="navbar-form navbar-left" role="search">
                        <div class="form-group">
                            <input type="text" class="form-control"/>
                        </div>
                        <button type="button" class="btn btn-default">留言给作者</button>
                    </form>
                    <ul class="nav navbar-nav navbar-right">
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">个人中心<strong
                                    class="caret"></strong></a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="#">我的资料</a>
                                </li>
                                <li>
                                    <a href="#">配置信息</a>
                                </li>
                                <li>
                                    <a href="#">哈拉少</a>
                                </li>
                                <li class="divider">
                                </li>
                                <li>
                                    <a style="color:#f3a1a3" th:href="@{/logout}">退出登录</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
        <!--数据库信息表单-->
        <div class="col-md-4 column">
            <!--提示信息-->
            <div class="alert alert-success alert-dismissable">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                <h4>
                    注意!
                </h4> <strong>Warning!</strong> Please Configure the database connection information here
                <!--                <a href="#" class="alert-link">alert link</a>-->
                <a data-toggle="modal" data-target="#myModal">to Configure</a>
            </div>

            <!--            <h2><a class="btn btn-sm btn-success" th:href="@{/conf}">添加数据库配置</a></h2>-->
            <h2><a class="btn btn-sm btn-success" data-toggle="modal" data-target="#myModal">添加数据库配置</a></h2>
            <h2><a id="myConf" class="btn btn-sm btn-success" data-toggle="modal" data-target="#myModal1">我的数据库配置</a>
            </h2>

        </div>
        <!--三图iii-->
        <div class="col-md-8 column">
            <div class="row">
                <div class="col-md-4">
                    <div class="thumbnail">
                        <img class="nao" alt="300x200" th:src="@{/libs/img/iii2.jpg}"/>
                        <div class="caption">
                            <h3>
                                PojoMaker
                            </h3>
                            <p>
                                Generate entity class functionality from database tables,need DB information.
                            </p>
                            <p>
<!--                                <a  class="btn btn-primary" th:href="@{/admin/news/{id}/toUpdate(id=${news.id})}">编辑</a>-->
                                <a  class="btn btn-primary" th:href="@{/pojo}">Action</a>
<!--                                <a class="btn btn-primary" onclick="toPojo()">Action</a>-->
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="thumbnail">
                        <img class="nao" alt="300x200" th:src="@{/libs/img/iii4.jpg}"/>
                        <div class="caption">
                            <h3>
                                JsonMaker
                            </h3>
                            <p>
                                Generate test data based on entity classes,suitable for back-end human test interfaces.
                            </p>
                            <p>
                                <a class="btn btn-primary" href="#">Action</a>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="thumbnail">
                        <img class="nao" alt="300x200" th:src="@{/libs/img/iii3.jpg}"/>
                        <div class="caption">
                            <h3>
                                GirlMaker
                            </h3>
                            <p>
                                Cras justo odio, dapibus ac facilisis in, egestas eget quam. Donec id elit non mi porta.
                            </p>
                            <p>
                                <a class="btn btn-primary" href="#">Action</a>
                                <!--                                <a class="btn" href="#">Action</a>-->
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--音乐-->
        <div class="col-md-12 column">
            <div class="modal fade" id="modal-container-85792" role="dialog" aria-labelledby="myModalLabel"
                 aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title" id="myModalLabel">
                                程序员心咒
                            </h4>
                        </div>
                        <div class="modal-body">
                            <audio id="audio1" controls="controls">
                                <source th:src="@{/libs/img/ps.mp3}" type="audio/ogg">
                            </audio>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                            <!--                            <button type="button" class="btn btn-primary">保存</button>-->
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--模态框添加数据库配置-->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="Modal"
             aria-hidden="true">
            <div class="modal-dialog" style="width:45%;">
                <div class="modal-content">
                    <div class="modal-header">
                        <!--                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>-->
                        <h4 class="modal-title" id="Modal">数据库配置</h4>
                    </div>
                    <div class="modal-body">
                        <!--                        表单信息-->
                        <form role="form" id="form1" onsubmit="return false" action="##" method="post">
                            <div class="form-group">
                                <label for="database">database</label>
                                <input class="form-control" id="database" type="text" required="required"
                                       placeholder=" 例 : 39.105.153.98:3306/database-name" name="url"
                                       oninvalid="setCustomValidity('please input database')"
                                       oninput="setCustomValidity('')"
                                       autocomplete="off"/>
                            </div>
                            <div class="form-group">
                                <label for="username">username</label>
                                <input class="form-control" id="username" type="text" required="required"
                                       placeholder=" 例 : root" name="username"
                                       oninvalid="setCustomValidity('please input username')"
                                       oninput="setCustomValidity('')"
                                       autocomplete="off"/>
                            </div>
                            <div class="form-group">
                                <label for="password">password</label>
                                <input class="form-control" id="password" type="password" required="required"
                                       placeholder=" 例 : YoGoYun.com" name="password"
                                       oninvalid="setCustomValidity('please input password')"
                                       oninput="setCustomValidity('')"
                                       autocomplete="new-password"/>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal" onclick="refreshPage()">取消
                        </button>
                        <button type="button" class="btn btn-primary" onclick="addConf()">添加</button>
                        <!--                        <button style="VISIBILITY: hidden" id="selConf" type="button" class="btn btn-primary"-->
                        <!--                                onclick="refreshPage()">刷新页面隐藏按钮-->
                        <!--                        </button>-->
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal -->
        </div>
        <div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="Modal"
             aria-hidden="true">
            <div class="modal-dialog" style="width:45%;">
                <div class="modal-content">
                    <div class="modal-header">
                        <!--                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>-->
                        <h4 class="modal-title" id="Modal2">数据库配置</h4>
                    </div>
                    <div class="modal-body">
                        <!--                        表单信息-->
                        <form role="form" id="form2" onsubmit="return false" action="##" method="post">
                            <div class="form-group">
                                <label for="database">database</label>
                                <input type="hidden" id="cid1" name="cid"/>
                                <input class="form-control" id="database1" type="text" required="required"
                                       placeholder=" 例 : 39.105.153.98:3306/database-name" name="url"/>
                            </div>
                            <div class="form-group">
                                <label for="username">username</label>
                                <input class="form-control" id="username1" type="text" required="required"
                                       placeholder=" 例 : root" name="username"
                                       oninvalid="setCustomValidity('please input username')"
                                       oninput="setCustomValidity('')"
                                       autocomplete="off"/>
                            </div>
                            <div class="form-group">
                                <label for="password">password</label>
                                <input class="form-control" id="password1" type="text" required="required"
                                       placeholder=" 例 : YoGoYun.com" name="password"/>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal" onclick="openMyConf()">取消
                        </button>
                        <button type="button" class="btn btn-primary" onclick="editConf()">保存</button>
                        <!--                        <button style="VISIBILITY: hidden" id="selConf" type="button" class="btn btn-primary"-->
                        <!--                                onclick="refreshPage()">刷新页面隐藏按钮-->
                        <!--                        </button>-->
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal -->
        </div>
        <!--模态框我的数据库配置-->
        <div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="Modal"
             aria-hidden="true">
            <div class="modal-dialog" style="width:70%;">
                <div class="modal-content">
                    <div class="modal-header">
                        <!--                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>-->
                        <h4 class="modal-title" id="Modal1">我的配置</h4>
                    </div>
                    <div class="modal-body">
                        <div id="dp" class="table-responsive" th:fragment="confList">
                            <table class="table table-striped table-sm">
                                <thead>
                                <tr>
                                    <th>☆table</th>
                                    <th>link</th>
                                    <th>username</th>
                                    <th>pwd</th>
                                    <th>createTime</th>
                                    <th>action</th>
                                    <th>status</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="c:${conf}">
                                    <td th:text="${c.lib}"></td>
                                    <td th:text="${c.url}"></td>
                                    <td th:text="${c.username}"></td>
                                    <td th:text="${c.password}"></td>
                                    <td th:text="${#dates.format(c.createTime, 'yyyy年MM月dd')}"></td>
                                    <td style="width: auto">
                                        <a class="btn btn-sm btn-primary" data-toggle="modal" data-target="#myModal2"
                                           data-dismiss="modal"
                                           th:onclick="section([[${c.id}]],[[${c.lib}]],[[${c.url}]],[[${c.username}]],[[${c.password}]])"
                                        >编辑</a>

                                        <a class="btn btn-danger btn-sm" th:onclick="del([[${c.id}]])">删除</a>

                                        <button style="font-size: 3px" class="btn btn-success btn-sm"
                                                th:onclick="'javascript:chooseConf('+${c.id}+')'">应用
                                        </button>
                                    </td>
                                    <td th:if="${c.enable} eq 0">
                                    </td>
                                    <td th:if="${c.enable} eq 1">
                                        <!--                                        <a class="btn btn-danger btn-sm">USE</a>-->
                                        <a href="#">
                                            <span class="glyphicon glyphicon-tree-conifer">USE</span>
                                        </a>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-dismiss="modal">好的我知道啦
                        </button>
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal -->
        </div>
    </div>
</div>


<script th:inline="javascript">
    //播放器
    play_mp3 = function () {
        let audio = document.getElementById('audio1');
        let btn1 = document.getElementById('btn');
        if (audio !== null) {
            if (audio.paused) {
                btn1.value = "暂停";
                audio.play();
            } else {
                btn1.value = "开始";
                audio.pause();
            }
        }
    };

    //选择应用哪一个数据库配置
    function chooseConf(id) {
        console.log("应用的配置ID是:" + id);
        $.ajax({
            type: "POST",
            dataType: "json",
            url: "/conf/choose",
            contentType: 'application/x-www-form-urlencoded',
            data: {
                "id": id
            },
            success: function (result) {
                if (result.status === 200) {
                    $('#dp').load("/conf/get");
                }
            },
        });
    }

    //为编辑数据库配置做缓存区，存储数据做回显。
    function section(id, lib, url, username, password) {
        $("#cid1").val(id);
        $("#database1").val(url + "/" + lib);
        $("#username1").val(username);
        $("#password1").val(password)
    }

    //删除数据库配置
    function delConf(id) {
        $.ajax({
            type: "POST",
            dataType: "json",
            url: "/conf/del",
            contentType: 'application/x-www-form-urlencoded',
            data: {
                "id": id
            },
            success: function (result) {
                refreshPage();
            },
        });
    }

    //添加数据库配置
    function addConf() {
        let username = document.getElementById("username").value;
        let password = document.getElementById("password").value;
        let database = document.getElementById("database").value;
        let split = database.split("\/");
        if (isEmpty(split[0])) {
            myAlert("请输入有效的数据库连接地址 例如 : 39.105.153.98:3306/table", null, "提示");
            return false;
        }
        let dbName = split[1];
        let uri = split[0];

        let re1url = new RegExp(/(([0-9]{1,3}\.){3}[0-9]{1,3}|([0-9a-z_!~*'-]+\.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z]\.[a-z]{2,6}|localhost)(:[0-9]{2,6})?(\/?)$/);
        if (re1url.test(uri) === false) {
            myAlert("请输入有效的数据库连接地址 例如 : 39.105.153.98:3306/table", null, "提示");
            return false;
        }

        if (isEmpty(dbName)) {
            myAlert("请输入有效的数据库库名", null, "提示");
            return false;
        }
        if (isEmpty(username)) {
            myAlert("请输入数据库用户名", null, "提示");
            return false;
        }
        if (isEmpty(password)) {
            myAlert("请输入数据库密码", null, "提示");
            return false;
        }
        $.ajax({
            type: "POST",
            dataType: "json",
            url: "/conf/add",
            contentType: 'application/json;charset=utf-8',
            data: JSON.stringify({
                "username": username,
                "password": password,
                "url": uri,
                "lib": dbName
            }),
            success: function (result) {
                if (result.status === 200) {
                    $('#myModal').modal('hide');
                    clean();
                    $('#dp').load("/conf/get");
                    openMyConf()
                }
            },
        });
    }

    //编辑数据库配置
    function editConf() {
        let cid = document.getElementById("cid1").value;
        let username = document.getElementById("username1").value;
        let password = document.getElementById("password1").value;
        let database = document.getElementById("database1").value;
        let split = database.split("\/");
        if (isEmpty(split[0])) {
            myAlert("请输入有效的数据库连接地址");
            return false;
        }
        let dbName = split[1];
        let uri = split[0];
        console.log("数据库连接 :" + uri);
        console.log("表名 :" + dbName);

        let re1url = new RegExp(/(([0-9]{1,3}\.){3}[0-9]{1,3}|([0-9a-z_!~*'-]+\.)*([0-9a-z][0-9a-z-]{0,61})?[0-9a-z]\.[a-z]{2,6}|localhost)(:[0-9]{2,6})?(\/?)$/);
        if (re1url.test(uri) === false) {
            myAlert("请输入有效的数据库连接地址 例如 : 39.105.153.98:3306/table", null, "提示");
            // alert("请输入有效的数据库连接地址！");
            return false;
        }
        if (isEmpty(dbName)) {
            myAlert("请输入有效的数据库库名 例如 : 39.105.153.98:3306/table", null, "提示");
            return false;
        }
        if (isEmpty(username)) {
            myAlert("请输入数据库用户名", null, "提示");
            return false;
        }
        if (isEmpty(password)) {
            myAlert("请输入数据库密码", null, "提示");
            return false;
        }
        $.ajax({
            type: "POST",
            dataType: "json",
            url: "/conf/edit",
            contentType: 'application/json;charset=utf-8',
            data: JSON.stringify({
                "id": cid,
                "username": username,
                "password": password,
                "url": uri,
                "lib": dbName
            }),
            success: function (result) {
                if (result.status === 200) {
                    $('#myModal2').modal('hide');
                    $('#dp').load("/conf/get");
                    openMyConf();
                } else {
                    alert("error: " + result.message)
                }
            },
        });
    }

    //打开我的配置
    function openMyConf() {
        document.getElementById("myConf").click()
    }

    //删除我的配置
    function del(id) {
        myConfirm("您确定删除此配置？", function () {
            delConf(id)
        }, "确认");
    }

    //判断obj是否为空
    function isEmpty(obj) {
        return typeof obj == "undefined" || obj == null || obj === "";
    }

    //清空添加配置页面
    function clean() {
        $("#form1 input").each(function () {
            $(this).val('');
        });
    }

    //局部刷新页面
    function refreshPage() {
        $('#dp').load("/conf/get");
    }

    //页面加载时调用函数
    $(function () {
        refreshPage();
    })

    function toPojo() {
        window.location.href = "/pojo.html";
    }
</script>
</body>
</html>